{% extends "base.html" %} {% block title %}Local Upload to Cloudinary -
Bazarchic DB Tool{% endblock %} {% block content %}
<div class="space-y-6">
  <!-- Header -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold text-gray-800">
      <i class="fas fa-cloud-upload-alt text-cloudinary mr-2"></i>Upload Images to
      Cloudinary
    </h1>
    <p class="text-gray-600 mt-2">
      Upload images from your computer to Cloudinary with bulk processing
    </p>
  </div>

  <!-- Upload Form -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <form
      method="POST"
      action="{{ url_for('cloudinary.local_upload') }}"
      id="localUploadForm"
      enctype="multipart/form-data"
    >
      <!-- File Upload Section with Improved Design -->
      <div class="mb-6">
        <label class="block text-lg font-semibold text-gray-800 mb-4">
          <i class="fas fa-images text-blue-600 mr-2"></i>Select Image Files
        </label>
        
        <!-- Hidden input -->
        <input
          type="file"
          name="files"
          id="fileUpload"
          multiple
          required
          accept="image/*,.jpg,.jpeg,.png,.gif,.bmp,.webp,.svg"
          class="hidden"
        />
        
        <!-- Custom Upload Area -->
        <div class="relative">
          <label
            for="fileUpload"
            id="dropZone"
            class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer bg-gradient-to-br from-gray-50 to-gray-100 hover:from-blue-50 hover:to-blue-100 hover:border-primary transition-all duration-300 group"
          >
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <div
                class="mb-4 p-3 bg-white rounded-full shadow-md group-hover:shadow-lg transition-shadow duration-300"
              >
                <i
                  class="fas fa-cloud-upload-alt text-3xl text-primary group-hover:text-blue-700 transition-colors duration-300"
                ></i>
              </div>
              <p
                class="mb-2 text-sm text-gray-600 group-hover:text-blue-700 transition-colors duration-300"
              >
                <span class="font-semibold">Click to upload</span> or drag and
                drop
              </p>
              <p
                class="text-xs text-gray-500 group-hover:text-primary transition-colors duration-300"
              >
                Select multiple image files to upload
              </p>
              <div
                class="mt-2 px-3 py-1 bg-blue-100 text-primary rounded-full text-xs font-medium group-hover:bg-blue-200 transition-colors duration-300"
              >
                JPG, PNG, GIF, BMP, WEBP, SVG
              </div>
            </div>
            
            <!-- Drag overlay -->
            <div
              id="dragOverlay"
              class="hidden absolute inset-0 bg-blue-500 bg-opacity-20 border-2 border-primary rounded-xl flex items-center justify-center"
            >
              <div class="text-center">
                <i class="fas fa-download text-blue-600 text-5xl mb-3"></i>
                <p class="text-xl font-bold text-blue-700">Drop files here</p>
              </div>
            </div>
          </label>
        </div>
        
        <!-- File List -->
        <div id="fileListContainer" class="hidden mt-4">
          <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
            <div class="flex items-center justify-between mb-3">
              <h4 class="font-semibold text-gray-800 flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                Selected Files
              </h4>
              <span id="fileCount" class="text-sm font-medium text-blue-600 bg-blue-100 px-3 py-1 rounded-full">
                <span id="fileCountText">0 files</span>
              </span>
            </div>
            <div id="fileList" class="space-y-2 max-h-64 overflow-y-auto"></div>
            <button
              type="button"
              onclick="clearFiles()"
              class="mt-3 text-sm text-red-600 hover:text-red-700 font-medium flex items-center"
            >
              <i class="fas fa-times-circle mr-1"></i>
              Clear all files
            </button>
          </div>
        </div>
        
        <input type="hidden" name="input_method" value="browse" />
      </div>

      <!-- Thread Count -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Concurrent Threads</label
        >
        <input
          type="number"
          name="max_workers"
          value="10"
          min="1"
          max="20"
          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-300"
        />
        <p class="text-sm text-gray-500 mt-2">
          Number of concurrent upload threads (recommended: 5-15)
        </p>
      </div>

      <!-- Cloudinary Folder Name -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2"
          >Cloudinary Folder Name (Optional)</label
        >
        <input
          type="text"
          name="cloudinary_folder"
          class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-300"
          placeholder="Leave empty to use default folder"
        />
        <p class="text-sm text-gray-500 mt-2">
          Custom folder name in Cloudinary (default: bazarchic_images)
        </p>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        id="submitBtn"
        class="w-full bg-primary hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-xl flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-none"
      >
        <i class="fas fa-cloud-upload-alt mr-3 text-lg" id="submitIcon"></i>
        <span id="submitText" class="text-lg">Start Upload</span>
      </button>
    </form>
  </div>

  <!-- Progress Container (Hidden by default) -->
  <div id="progressContainer" class="bg-white rounded-lg shadow-md p-6 hidden">
    <h2 class="text-lg font-bold text-gray-800 mb-4">
      <i class="fas fa-spinner fa-spin text-blue-600 mr-2"></i>Upload Progress
    </h2>
    <div class="mb-4">
      <div class="flex justify-between text-sm text-gray-600 mb-2">
        <span>Progress</span>
        <span id="progressPercentage">0%</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-4">
        <div
          id="progressBar"
          class="bg-gradient-to-r from-blue-600 to-cyan-600 h-4 rounded-full transition-all duration-300"
          style="width: 0%"
        ></div>
      </div>
    </div>
    <div
      id="progressLog"
      class="bg-gray-50 rounded-lg p-4 max-h-60 overflow-y-auto"
    >
      <p class="text-sm text-gray-600">Initializing upload...</p>
    </div>
  </div>

  <!-- Info Panel -->
  <div
    class="bg-gradient-to-br from-cyan-50 to-blue-50 rounded-lg shadow-md p-6 border border-cyan-200"
  >
    <h2 class="text-lg font-bold text-gray-800 mb-4">
      <i class="fas fa-info-circle text-cyan-600 mr-2"></i>How It Works
    </h2>
    <div class="space-y-3 text-gray-700">
      <p class="flex items-start">
        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
        <span
          ><strong>File Upload:</strong> Upload images directly from your computer (recommended for online use)</span
        >
      </p>
      <p class="flex items-start">
        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
        <span
          ><strong>Multi-threaded:</strong> Uses concurrent threads for faster
          batch uploads</span
        >
      </p>
      <p class="flex items-start">
        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
        <span
          ><strong>Supported Formats:</strong> JPG, JPEG, PNG, GIF, BMP, WEBP,
          SVG</span
        >
      </p>
      <p class="flex items-start">
        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
        <span
          ><strong>CSV Export:</strong> Downloads a CSV file with filenames and
          Cloudinary URLs</span
        >
      </p>
      <p class="flex items-start">
        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
        <span
          ><strong>Progress Tracking:</strong> Real-time updates on upload
          status</span
        >
      </p>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById("localUploadForm");
  const submitBtn = document.getElementById("submitBtn");
  const submitIcon = document.getElementById("submitIcon");
  const submitText = document.getElementById("submitText");
  const progressContainer = document.getElementById("progressContainer");
  const fileUpload = document.getElementById("fileUpload");
  const fileCountText = document.getElementById("fileCountText");
  const dropZone = document.getElementById("dropZone");
  const dragOverlay = document.getElementById("dragOverlay");
  const fileListContainer = document.getElementById("fileListContainer");
  const fileList = document.getElementById("fileList");

  // Format file size
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
  }

  // Get file icon based on extension
  function getFileIcon(filename) {
    const ext = filename.split('.').pop().toLowerCase();
    const iconMap = {
      'jpg': 'fa-file-image text-blue-500',
      'jpeg': 'fa-file-image text-blue-500',
      'png': 'fa-file-image text-green-500',
      'gif': 'fa-file-image text-purple-500',
      'svg': 'fa-file-image text-orange-500',
      'webp': 'fa-file-image text-teal-500',
      'bmp': 'fa-file-image text-red-500'
    };
    return iconMap[ext] || 'fa-file text-gray-500';
  }

  // Display selected files
  function displayFiles(files) {
    fileList.innerHTML = '';
    
    if (files.length === 0) {
      fileListContainer.classList.add('hidden');
      return;
    }

    fileListContainer.classList.remove('hidden');
    fileCountText.textContent = `${files.length} file${files.length !== 1 ? 's' : ''}`;

    Array.from(files).forEach((file, index) => {
      const fileItem = document.createElement('div');
      fileItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors';
      fileItem.innerHTML = `
        <div class="flex items-center flex-1 min-w-0">
          <i class="fas ${getFileIcon(file.name)} text-xl mr-3"></i>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-800 truncate">${file.name}</p>
            <p class="text-xs text-gray-500">${formatFileSize(file.size)}</p>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
            <i class="fas fa-check mr-1"></i>Ready
          </span>
        </div>
      `;
      fileList.appendChild(fileItem);
    });
  }

  // Handle file selection
  fileUpload.addEventListener('change', function(e) {
    displayFiles(e.target.files);
  });

  // Clear all files
  function clearFiles() {
    fileUpload.value = '';
    fileListContainer.classList.add('hidden');
    fileList.innerHTML = '';
  }

  // Drag and drop handlers
  dropZone.addEventListener('dragover', function(e) {
    e.preventDefault();
    e.stopPropagation();
    dragOverlay.classList.remove('hidden');
  });

  dropZone.addEventListener('dragleave', function(e) {
    e.preventDefault();
    e.stopPropagation();
    if (e.target === dropZone) {
      dragOverlay.classList.add('hidden');
    }
  });

  dropZone.addEventListener('drop', function(e) {
    e.preventDefault();
    e.stopPropagation();
    dragOverlay.classList.add('hidden');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      // Filter only image files
      const imageFiles = Array.from(files).filter(file => 
        file.type.startsWith('image/') || 
        /\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i.test(file.name)
      );
      
      if (imageFiles.length > 0) {
        // Create a new DataTransfer object to set files
        const dataTransfer = new DataTransfer();
        imageFiles.forEach(file => dataTransfer.items.add(file));
        fileUpload.files = dataTransfer.files;
        
        displayFiles(fileUpload.files);
      } else {
        alert('Please drop only image files (JPG, PNG, GIF, etc.)');
      }
    }
  });

  // Form submission
  form.addEventListener("submit", function (e) {
    if (fileUpload.files.length === 0) {
      e.preventDefault();
      alert('Please select at least one image file to upload');
      return;
    }

    // Show progress container
    progressContainer.classList.remove("hidden");

    // Disable submit button
    submitBtn.disabled = true;
    submitIcon.className = "fas fa-spinner fa-spin mr-2";
    submitText.textContent = "Uploading...";

    // Scroll to progress container
    progressContainer.scrollIntoView({ behavior: "smooth", block: "center" });
  });
</script>
{% endblock %}
